name: Universal QA System

on: [push, pull_request]

jobs:
  qa-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Codice
        uses: actions/checkout@v4

      - name: Build Engine
        run: docker build -t qa-engine -f Dockerfile .

      - name: Run Engine su tutti i file
        run: |
          echo "--- REPORT QA GLOBALE ---" > qa_report.log
          echo "Generato il: $(date)" >> qa_report.log
          
          FILES=$(find . -maxdepth 1 -type f | grep -E '\.(cpp|py|m|tex)$' | grep -v "tester.cpp" | sed 's|./||')
          
          for file in $FILES; do
            echo "ðŸš€ Analisi in corso su: $file"
            docker run --rm -v ${{ github.workspace }}:/github/workspace qa-engine "$file" || true
          done

      - name: Upload Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: QA-Complete-Report
          path: qa_report.log